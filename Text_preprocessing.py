from os import rename
import pandas as pd
from sqlalchemy import create_engine, Table, Column, String, MetaData

# PostgrSQL database connection information
dbUri = "localhost"
dbPort = "5432"
dbName = "postgres"
dbSchema = "adhoc"
dbUser = "postgres"
dbPassword = input("Enter Database Password: ")
dbString = "postgresql://"+dbUser+":"+dbPassword+"@"+dbUri+ ":"+ dbPort +"/" + dbName

# SQL query with subquery that uses RegEx to replace strings with an empty space, thus cleaning the text from the strings
sqlQuery = """SELECT 
  *, 
  regexp_replace(
    text_pre, 'ABOUT.*|Contacts.*|Enquiries\:.*|For further information, please contact\:.*|For further information\:.*|Forward-looking statements.*|Further information\:.*|If you have any questions, please contact\:.*|Media enquiries\:.*|Notifying person.*|Responsible parties.*|Responsible\:.*|Your contact\:.*|About.*|Contact.*|End of Ad-hoc Announcement.*|The DGAP Distribution Services include.*|Disclaimer.*|For more information,.*|For further informationen.*|For more information on.*|DGAP''s Distribution Services include.*|For enquiries,.*|For inquiries,.*|IMPORTANT NOTES:.*|Inquiries\..*|Inquiries:.*|For additional information,.*|Information and Explaination of the Issuer to this News.*|Additional information:.*|More Information:.*|Phone:.*|For further information please contact:.*|Firmensitz:.*|Investor Relations\..*|End of the ad-hoc notification.*|Person communicating:.*|NOTIFYING PERSON:.*|Contact:.*|End of.*|Investor Relations inquiries:.*|Legal Disclaimer\..*|For additional information please contact:.*|Important notice\..*', 
    ''
  ) AS text_pos 
FROM 
  (
    SELECT 
      *, 
      regexp_replace(
        text, '.*?THE RELEVANT LAWS OR REGULATIONS OF SUCH JURISDICTION|.*?VIOLATION OF THE RELEVANT LAWS OR REGULATIONS OF SUCH JURISDICTION|^Ad Hoc Announcement|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION IN THE UNITED STATES OF\. AMERICA, CANADA, AUSTRALIA OR JAPAN|.*?AD HOC Announcement According to \§15 WpHG|.*?Ad hoc disclosure in accordance with section 15 WpHG|.*?BY\. APPLICABLE LAW|.*?JURISDICTION IN WHICH THE DISTRIBUTION OR RELEASE WOULD BE UNLAWFUL|.*?Public disclosure of inside information according to Article 17 para\. 1 of the Regulation \(EU\) No 596\/2014 on market abuse|^Ad-Hoc Message|^PRESS RELEASE|^Ad-hoc release|^Press Release|.*?Public disclosure of inside information in accordance with Article 17 MAR|^Press release|^ASX Release|.*?Publication of inside information pursuant to Art. 17 of Regulation \(EU\)\. No\. 596\/2014|.*?in accordance with Article 17 of the Market Abuse Regulation \(MAR\)|.*?Inside information pursuant to Article 17 MAR|.*?Insider information pursuant to Article 17 of the Market Abuse Regulation \[MAR\]|.*?Disclosure of inside information according to Article 17 para\. 1 of the Regulation \(EU\) No\. 596\/2014|.*?Disclosure of inside information pursuant to Article 17 of Regulation \(EU\) No\. 596\/2014|.*?Insider information pursuant to Article 17 MAR|.*?NOT FOR DIRECT OR INDIRECT PUBLICATION, DISTRIBUTION OR RELEASE IN OR INTO THE UNITED STATES OF AMERICA, AUSTRALIA, CANADA AND JAPAN OR ANY JURISDICTION IN WHICH OFFERS OR SALES OF THE SECURITIES WOULD BE PROHIBITED BY APPLICABLE LAW|.*?NOT FOR DISTRIBUTION OR RELEASE, DIRECTLY OR INDIRECTLY, IN OR INTO CANADA, AUSTRALIA OR JAPAN OR ANY OTHER JURISDICTION IN WHICH THE DISTRIBUTION OR RELEASE WOULD BE UNLAWFUL\. OTHER RESTRICTIONS ARE APPLICABLE\. PLEASE SEE THE IMPORTANT NOTICE AT THE END OF THIS RELEASE|.*?NOT FOR DISTRIBUTION OR RELEASE, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES, CANADA, AUSTRALIA, JAPAN OR SOUTH AFRICA OR ANY OTHER JURISDICTION IN WHICH THE DISTRIBUTION OR RELEASE WOULD BE UNLAWFUL\. OTHER RESTRICTIONS ARE APPLICABLE\. PLEASE SEE THE IMPORTANT NOTICE AT THE END OF THE PRESS RELEASE|.*?NOT FOR DISTRIBUTION, PUBLICATION OR TRANSMISSION, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES, CANADA, AUSTRALIA, JAPAN, SOUTH AFRICA, SOANY OTHER JURISDICTION WHERE SUCH DISTRIBUTION OR PUBLICATION WOULD BE UNLAWFUL\. PLEASE READ THE IMPORTANT NOTICES AT THE END OF THIS DISCLOSURE|.*?NOT FOR PUBLICATION, DISTRIBUTION OR TRANSMISSION TO OR WITHIN THE UNITED STATES OF AMERICA, CANADA, JAPAN AND AUSTRALIA|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION, IN WHOLE OR IN PART, DIRECTLY OR INDIRECTLY, IN OR INTO OR FROM THE UNITED STATES, CANADA, AUSTRALIA OR JAPA  OR ANY OTHER JURISDICTION WHERE IT IS UNLAWFUL TO DISTRIBUTE THIS ANNOUNCEMENT\. OTHER RESTRICTIONS ARE APPLICABLE\. PLEASE SEE THE IMPORTANT NOTICE AT THE END OF THIS PUBLICATION|.*?THIS ANNOUNCEMENT IS NOT FOR RELEASE, DISTRIBUTION OR PUBLICATION IN WHOLE OR IN PART, DIRECTLY OR INDIRECTLY, WITHIN OR TO THE UNITED STATES, AUSTRALIA, CANADA, HONG KONG, JAPAN, NEW ZEALAND, SINGAPORE, SOUTH AFRICA, SOUTH KOREA, SWITZERLAND OR IN ANY OTHER JURISDICTION WHERE SUCH RELEASE, DISTRIBUTION OR PUBLICATION WOULD BE UNLAWFUL OR WOULD REQUIRE REGISTRATION OR ANY OTHER MEASURES IN ACCORDANCE WITH APPLICABLE LAW|.*?UPON THE PUBLICATION OF THIS ANNOUNCEMENT, THIS INSIDE INFORMATION IS NOW CONSIDERED TO BE IN THE PUBLIC DOMAIN|.*?Publication of inside information pursuant to Article 17 MAR|.*?Publication of inside information pursuant to Article 17 of Regulation \(EU\) No\. 596/2014|.*?Publication of insider information pursuant to Art\. 17\(1\) of Regulation \(EU\) No 596/2014 on Market Abuse \(Market Abuse Regulation - MAR\)|.*?Ad hoc announcement pursuant to Art\. 53 of the SWX Listing Rules|.*?NOT FOR DISTRIBUTION IN OR INTO OR TO ANY PERSON LOCATED OR RESIDENT IN THE UNITED STATES OF AMERICA, ITS TERRITORIES AND POSSESSIONS \(INCLUDING PUERTO RICO, THE U\.S\. VIRGIN ISLANDS, GUAM, AMERICAN SAMOA, WAKE ISLAND AND THE NORTHERN MARIANA ISLANDS\), ANY STATE OF THE UNITED STATES OF AMERICA OR THE DISTRICT OF COLUMBIA \(THE \"UNITED STATES\"\) OR IN OR INTO OR TO ANY PERSON RESIDENT OR LOCATED IN ANY OTHER JURISDICTION WHERE IT IS UNLAWFUL TO RELEASE, PUBLISH OR DISTRIBUTE THIS DOCUMENT|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION, DIRECTLY OR INDIRECTLY, INTO OR WITHIN THE UNITED STATES OF AMERICA, CANADA, AUSTRALIA, JAPAN OR ANY OTHER JURISDICTION WHERE IT IS UNLAWFUL TO DISTRIBUTE THIS ANNOUNCEMENT|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES, CANADA, JAPAN, SOUTH AFRICA OR ANY OTHER JURISDICTION WHERE TO DO SO WOULD CONSTITUTE A VIOLATION OF APPLICABLE LAWS OR REGULATIONS|.*?NOT FOR DISTRIBUTION OR RELEASE, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES, CANADA, AUSTRALIA OR JAPAN OR ANY OTHER JURISDICTION IN WHICH THE DISTRIBUTION OR RELEASE WOULD BE UNLAWFUL\. OTHER RESTRICTIONS ARE APPLICABLE|.*?Public disclosure of inside information according to Article 17 para\. 1 of the Regulation \(EU\) No 596/2014 on market abuse \(Market Abuse Regulation\)|.*?Disclosure of inside information according to Article 17 para. 1 of the Regulation (EU) No. 596/2014|.*?PLEASE SEE THE IMPORTANT NOTE AT THE END OF THIS PUBLICATION|.*?Disclosure of Insider Information as per\. Article 17 of MAR|.*?NOT FOR DISTRIBUTION, PUBLICATION OR FORWARDING, EITHER DIRECTLY OR INDIRECTLY, IN OR TO THE UNITED STATES OF AMERICA, CANADA, AUSTRALIA, JAPAN OR ANY OTHER JURISDICTION IN WHICH SUCH DISTRIBUTION OR PUBLICATION WOULD BE UNLAWFUL|.*?At the same time publication pursuant to § 111c of the German Stock Corporation Act \(Aktiengesetz\)|.*?PLEASE SEE THE IMPORTANT NOTICE AT THE END OF THIS PUBLICATION|.*?NOT FOR RELEASE OR DISTRIBUTION, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES OF AMERICA, AUSTRALIA, CANADA OR JAPAN OR ANY OTHER JURISDICTION IN WHICH SUCH RELEASE OR DISTRIBUTION WOULD BE UNLAWFUL|:*?Ad hoc announcement pursuant to Art\. 53 LR|.*?Disclosure of an inside information acc\. to Article 17 MAR of the Regulation \(EU\) No 596/2014|.*?Ad-hoc release pursuant to Article 17 MAR|.*?Release of an ad hoc announcement pursuant to Art\. 53 KR|.*?THE INFORMATION CONTAINED IN THIS DOCUMENT IS NOT INTENDED FOR PUBLICATION OR DISTRIBUTION, IN WHOLE OR IN PART, TO, WITHIN OR FROM THE UNITED STATES OF AMERICA OR ANY OTHER COUNTRY WHERE SUCH PUBLICATION OR DISTRIBUTION WOULD BE CONTRARY TO THE LAWS OF THAT COUNTRY|.*?Public disclosure of inside information according to Article 17 para\. 1 of the Regulation \(EU\) No 596/2014 on market abuse \(Market Abuse Regulation\)|.*?Not for release, publication or distribution in the United States, Australia, Japan or Canada|.*?Ad hoc release according to article 17 para\. 1 MAR|.*?PLEASE READ THE IMPORTANT NOTICES AT THE END OF THIS DISCLOSURE|.*?Announcement according to Article 17 European Market Abuse Regulation \(MAR\)|.*?Disclosure of inside information acc\. to Article 17 MAR|.*?Disclosure of an inside information acc\. to Article 17 Sec\. 1 of the Regulation \(EU\) No. 596/2014 \(Market Abuse Regulation - MAR\)|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES, CANADA, JAPAN, SOUTH AFRICA OR ANY OTHER JURISDICTION WHERE TO DO SO WOULD CONSTITUTE A VIOLATION OF APPLICABLE LAWS OR REGULATIONS|.*?Publication of inside information pursuant to Article 17 MAR|.*?NOT FOR DISTRIBUTION OR RELEASE, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES, CANADA, AUSTRALIA OR JAPAN OR ANY OTHER JURISDICTION IN WHICH THE DISTRIBUTION OR RELEASE WOULD BE UNLAWFUL\. OTHER RESTRICTIONS ARE APPLICABLE\.\\xa0\. Disclosure of an inside information acc\. to Article 17 Sec\. 1 of the Regulation \(EU\) No\. 596/2014 \(Market Abuse Regulation - MAR\)|.*?NOT FOR DISTRIBUTION, PUBLICATION OR TRANSMISSION, DIRECTLY OR INDIRECTLY, IN OR INTO THE UNITED STATES OF AMERICA, AUSTRALIA, CANADA, JAPAN OR ANY OTHER COUNTRY IN WHICH THE DISTRIBUTION OF THIS DOCUMENT IS UNLAWFUL|.*?Disclosure of inside information pursuant to Article 17 of the Regulation \(EU\) No 596\/2014|.*?Disclosure of inside information according to Article 17 para\. 1 of the Regulation \(EU\) No 596\/2014 on market abuse \(market abuse regulation\)|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION IN WHOLE OR IN PART IN OR INTO THE UNITED STATES, CANADA, AUSTRALIA OR JAPAN|.*?Publication of an insider information according to Article 17 MAR|Ad-hoc-News.|.*?Publication of insider information pursuant to Article 17 of Regulation \(EU\) No 596\/2014|.*?Ad-hoc-News\.|.*?Publication of an insider information in accordance with Article 17 MAR|.*?Publication of insider information pursuant to Article 17 of the Market Abuse Regulation\(Regulation\(EU\) No 596\/2014\)|.*?Publication of insider information pursuant to Article 17 of Regulation\(EU\) No 596\/2014|.*?Publication of insider information pursuant to Article 17 of the EU Market Abuse Regulation\(MAR\)|.*?PLEASE READ THE IMPORTANT NOTES AT THE END OF THIS ANNOUNCEMENT|.*?Publication of insider information pursuant to Article 17 of\(EU\) Regulation No 596\/2014|.*?Ad hoc Announcement according to§15 WpHG|.*?Insider Information according to Article 17 MAR|.*?Ad\.hoc notification in accordance with Sec 17 of the MAR|.*?Regulation\(EU\) No 596\/2014 on market abuse|.*?COUNTRY IN WHICH SUCH PUBLICATION OR DISTRIBUTION WOULD BE UNLAWFUL|.*?as amended\(Market Abuse Regulation MAR\)|.*?as amended\(market abuse regulation MAR\)|.*?Disclosure of an inside information according to Article 17 of the Regulation \(EU\) No 596\/2014 of the European Parliament and of the Council of April 16, 2014 on market abuse|.*?NOT FOR DISTRIBUTION IN THE UNITED STATES OF AMERICA, AUSTRALIA, CANADA AND JAPAN Press release|.*?Ad hoc announcement according to§ 15 WpHG|.*?any jurisdiction in which such distribution would be unlawful|.*?Sec 15 Securities Trading Act\(WpHG\)|.*?acc to Sec 15 WpHG|.*?acc to Sec\.15 WpHG|.*? 15 WpHG|.*?NOT FOR DISTRIBUTION, PUBLICATION, OR TRANSMISSION IN THE USA, CANADA, JAPAN AND AUSTRALIA|.*?WpHG\(Securities Trading Act\)|\(German Securities Trading Act\)|.*?USA, Canada, Japan and Australia\-|.*?Pursuant to Art 17 MAR|.*?Article 17 of MAR|.*?Regulation\(MAR\)|.*?596\/2014\(Market Abuse Regulation\- MAR\)|.*?CANADA AND JAPAN Press release|.*?WHICH SUCH A PUBLICATION MAY BE ILLEGAL|.*?EU Market Abuse Regulation\(MAR\)|.*?Ad-hoc announcement pursuant to section 17|.*?The issuer is solely responsible for the content of this announcement|.*?Commission Regulations\(EU\) NO 2273\/2003|.*?Sec 15 para 1 WpHG|.*?NOT FOR RELEASE, PUBLICATION OR DISTRIBUTION IN OR INTO THE UNITED STATES OF AMERICA, AUSTRALIA, CANADA OR JAPAN|.*?No 596\/2014\("MAR"\)|.*?TO\§15 WpHG|.*?15 Abs 1 WpHG from|.*?Trading Act\(WpHG\)|.*?NOT FOR DISTRIBUTION, PUBLICATION, OR TRANSMISSION IN THE UNITED STATES, AUSTRALIA, CANADA OR JAPAN|.*?German Securities TRading Act\(Wertpapierhandelsgesetz, WpHG\)|.*?announcement according to Section 17 MAR|.*?Art 17 of the Market Abuse Directive|.*?according to\§15 WpHG|.*?WKN\(German Securities Identification Number\) 720190 Berlin|.*?VIOLATION OF THE RELEVANT LAWS OF SUCH JURISDICTION|.*?Ad-hoc Release pursuant to Article 17|.*?to\§ 15 Sec 1 Securities Trading Act\(WpHG\)|.*?15\(1\) of the German Securities Trading Act\(WpHG\)|.*?according\§15 WpHG|.*?Inside information disclosure pursuant to Art\. 17 of the Market Abuse Regulation 596\/2014|.*?Media Information\.\(PDF\)|.*?Ad-hoc disclosure pursuant to section 15 of the German Securities Trading\. Act \(WpHG\)|.*?Publication of Insider Information pursuant to Article 17 of the Market Abuse Regulation|.*?DGAP-News:|.*?NEWS RELEASE\.|.*?the\. German Securities Trading Act \(WpHG\)|.*?a service of EQS Group AG|^AD-HOC-ANNOUNCEMENT|.*?a company of Equity Story AG\.|:*?Official Segment of Euronext Amsterdam N\.V\.|.*?transmitted by DGAP|.*?a service of EQS-Group AG|.*?Publication of an Insider Information according to Article 17 MAR as per 17 May 2018|.*?Publication of an Insider Information according to Article 17 MAR as per 21 December 2017|.*?ADHOC RELEASE pursuant to Article 15 German Securities Trading Act \(WpHG\)|.*?of the Regulation \(EU\) No\. 596\/2014|.*?DISCLOSURE OF INSIDE INFORMATION PURSUANT TO ART\. 17 OF THE EU MARKET ABUSE REGULATION \(EU 596\/2014, MAR\)|^market abuse regulation\)|^Ad hoc press release\.|^Ad hoc press release acc to section 15 of the Geramn Securities Trading\. Act \(WpHG\)|^Ad-hoc RELEASE\. Announcement according to § 15 Sec\. 1 Securities Trading Act \(WpHG\)|^Ad hoc-announcement|^Ad hoc-announcement according tp Art\. 17 MAR|^Ad hoc-announcement in accordance with §15 WpHG \(Securities Trading Act\)|^Ad hoc-announcement pursuant to Article 17 of the Market Abuse Regulation|^Ad hoc-Announcement|^Ad hoc-Notification pursuant to Section 15 \(1\) WpHG|^Ad hoc announcement acc to Section 15 of German Securities Trading Act\. \(WpHG\)|^Ad hoc announcement acc to Art\. 17 MAR|^Ad hoc announcement acc to Section 15 of German Securities Trading Act\. \(WpHG\)|.*?NOT FOR DISTRIBUTION, PUBLICATION, OR TRANSMISSION IN USA, CANADA, JAPAN\. AND AUSTRALIA|^Ad hoc Announcement\.|^Ad hoc announcement\.|^Ad hoc ANNOUNCEMENT\.|^Ad hoc announcement:|^Ad hoc disclosure according to Section 15 of the WpHG\.|^Ad hoc Message\.|^Ad hoc notification in accordance with section 15 of the German Securities\. Trading Act \(WpHG\)\.|^Ad hoch RELEASE \(PURSUANT TO SECTION 17 GERMAN SECURITIES TRADING ACT \(WPHG\)\)|^Ad hoc Release:|^Ad hoc release:|^Ad hoc report in accordance with Sec\. 15 of the German Securities Trading \. Act\.|.*?WKN\(German Securities Identification Number\) 720190\. Berlin|^Ad-hoc notification in accordance with Sec\. 17 of the MAR\.|^Ad-hoc Release pursuant to Art\. 17 MAR\.|^Ad-hoc RELEASE\. Announcement according to §15 Sec\. 1 Securities Trading Act \(WpHG\)|^market abuse regulation - MAR\)\. Ad-hoc:|^Market Abuse Regulation - MAR\)\. Ad-hoc:|.*?Ad-hoc-Disclosure pursuant to § 15 of the WpHG|^Ad noc Notification Pursuant to § 15 of the German Securities Trading Act\. \(WpHG\)|.*?Ad-hoc release, 10 June 2016|.*?Ad-hoc release, 09 June 2016|.*?Publication of an inside information according to Article 17 MAR|.*?Publication of a notice pursuant to Article 17 \(1\) of the Market Abuse Regulation \(Regulation \(EU\) No\. 596\/2014, "MAR"\)\. ADLER Group S\.A\. NOT FOR DISTRIBUTION, PUBLICATION OR TRANSMISSION IN OR INTO THE UNITED STATES OF AMERICA, AUSTRALIA, CANADA OR JAPAN|.*?Publication of an ad hoc disclosure pursuant to Art\. 17 MAR\.|.*?Publication of an ad hoc release pursuant to Section 15 of the German\. Securities Trading Act \(Wertpapierhandelsgesetz, WpHG\)\.|.*?Publication of an inside information according to Art\. 17 MAR|.*?Publication of an Inside Information according to Article 17 MAR|.*?Publication of an inside information pursuant to Section 17 of the regulation \(EU\) No\. 596\/2014\.|.*?Publication of Inside Information according to Article 17 MAR|.?Publication of inside information in accordance with Article 17 MAR*|.*?Publication of an insider information pursuant to Section 17 of the regulation \(EU\) No\. 596\/2014\.|.*?Publication of inside information in accordance with Article 17 of Regulation \(EU\) No\. 596\/2014\.|.*?Publication of inside information pursuant to Article 17 of Regulation \(EU\) No 596\/2014\.|.*?Publication of inside information pursuant to \. Article 17 MAR|.*?Publication of Inside Information pursuant to Article 17 of the Market Abuse Regulation\.|.*?Publication of insider information \(ad-hoc announcement\) pursuant to Article 17 MAR|.*?Publication of insideR information pursuant to Article 17 of Regulation \(EU\) No\. 596\/2014\.|.*?Publication of insider information pursuant to Article 17 MAR\.' ,  ''
      ) AS text_pre 
    FROM 
      adhoc.adhoc_clean
  ) AS sub
  WHERE length("text") >=200; """

sourceTables = ['data/adhoc_clean.csv']

# Open CSV file
def main():
    csvsToDb(sourceTables)
    runQuery(sqlQuery)
    print("All Done!")

# Store ad-hoc message dataframe as SQL table
def writeToDb(dataframe,dbString,schema,table):
    # Connect to Database
    engine = create_engine(dbString)
    connection = engine.connect()

    # Create schema if it doesn't exist
    try:
        connection.execute('CREATE SCHEMA "'+schema+'"')
        print('Schema "'+schema+'" has been created.')
    except:
        print('Schema "'+schema+'" already exists.')

    # Drop table if it exists
    # Then upload to database
    try:
        connection.execute('DROP TABLE  "'+schema+'"."'+table+'"')
        print("Table "+schema+"."+table+" deleted.........")
    except: 
        print("Table "+schema+"."+table+" does not exist and thus will be created.........")
    finally:
        dataframe.to_sql(table, connection, schema=schema,method='multi',chunksize=5000,index=False) 
        print("Table "+schema+"."+table+" written to Postgres Database.........")
    connection.close()
    engine.dispose()

def csvsToDb(csvList):
    for csv in csvList:
        df = pd.read_csv(csv)
        tableName = csv.split("/")[-1]
        tableName = tableName.split(".")[0]
        writeToDb(df,dbString,dbSchema,tableName)
        print(tableName+" Done!")

# Run SQL query specified above and perform additional RegEx text cleaning
def runQuery(query):
    engine = create_engine(dbString)
    connection = engine.connect()
    query_result = pd.read_sql_query(query,connection)
    connection.close()
    engine.dispose()
    query_result = query_result.drop(columns=['text_pre', 'text'])
    query_result = query_result.rename(columns={"text_pos": "text"})
    query_result['text'].replace(to_replace="\s\s+", value=" ", regex=True, inplace=True)
    query_result['text'].replace(to_replace="(\. *){2,}", value=". ", regex=True, inplace=True)
    query_result['text'].replace(to_replace="^[^a-z]+(?:\s[^a-z]+)+ ", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\. (?=[a-z])", value=" ", regex=True, inplace=True)
    query_result['text'].replace(to_replace="^\.+[^a-z-A-Z-0-9-(]+", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\.(?=\()", value=" ", regex=True, inplace=True)
    query_result['text'].replace(to_replace="the\.", value="the", regex=True, inplace=True)
    query_result['text'].replace(to_replace="#", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\-{2,}", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\*{2,}", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="(- ){2,}", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\+{2,}", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\_{2,}", value="", regex=True, inplace=True)
    query_result['text'].replace(to_replace="\s\s+", value=" ", regex=True, inplace=True)
    query_result.to_csv('data/adhoc_clean.csv', index=False)
    query_result.to_csv('data/adhoc_date_ident.csv', columns=['datetime', 'identifier'], index=False)

main()